---
title: 'Case Study: How Can a Wellness Technology Company Play It Smart?'
author: "Allan C Mathews"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<center><img
src="https://d3tjvo8nusckpy.cloudfront.net/wp-content/uploads/2020/10/bb_4.jpg">
</center>


# Summary

Bellabeat is a high-tech manufacturer of health-focused smart products for women.The Bellabeat app provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions and connects to their line of smart wellness products.

## Objective
To focus on one of Bellabeat’s products and analyze the smart device data to gain insight into how consumers are using their smart devices and with these insights could guide the marketing strategy for the company.

To answer the key business questions, **the six steps of the data analysis process: ask, prepare, process, analyze, share, and act** will be followed and explained step by step.

# Ask phase :Ask Questions to Make Data-Driven Decisions
## Business Task
* Identify trends in smart device usage
* How could these trends apply to Bellabeat customers?
* How could these trends help influence Bellabeat marketing strategy?

## Key Stakeholders
* **Urška Sršen**: Bellabeat’s cofounder and Chief Creative Officer
* **Sando Mur**: Mathematician and Bellabeat’s cofounder
* **Bellabeat marketing analytics team**: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy.



# Prepare phase: Prepare Data for Exploration
## Data source
[FitBit Fitness Tracker Data](https://www.kaggle.com/arashnic/fitbit), This dataset is stored in Kaggle as a public domain and was made available through [Mobius](https://www.kaggle.com/arashnic).

## Accessibility and privacy of data
This dataset is open-sourced and were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. It includes information about daily activity, steps, and heart rate that can be used to explore users’ habits.Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.


## Data Intergrity
The dataset contains only data of thirty fitbit users without any demographic details,hence it cannot be determined if there is any sampling bias. Another problem we would encounter is that the dataset is not current and has only 2 months period data. That is why we will give our case study an operational approach

```{r echo=TRUE, warning=FALSE,message=FALSE}
# Read libraries here
library(tidyverse) #for data visualization and data manipulation
library(skimr) # to use functions provides a larger set of statistics
library(lubridate) # to work with date and time objects
```
```{r warning=FALSE,message=TRUE}
# Read the data here
daily_activity <- read.csv('Fitabase_Data/dailyActivity_merged.csv')
sleep_log <- read.csv("Fitabase_Data/sleepDay_merged.csv")
weight_log <- read.csv("Fitabase_Data/weightLogInfo_merged.csv")
glimpse(daily_activity)
glimpse(sleep_log)
glimpse(weight_log)
```
# Process phase: Process Data from Dirty to Clean
## Data Cleaning
### Data Formatting
* Format Id column from numeric to character type
* Format Date column from character to Date type
```{r echo=TRUE, warning=FALSE,message=FALSE}
# Formatting
# Format Id column to character type
daily_activity <- transform(daily_activity,
                             Id = as.character(Id))
sleep_log <- transform(sleep_log,
                             Id = as.character(Id))
 
weight_log <- transform(weight_log,
                             Id = as.character(Id))
# Format Date column from character to Date type
daily_activity$ActivityDate <-  as.Date(daily_activity$ActivityDate,format='%m/%d/%Y') 
sleep_log <- sleep_log %>%
  separate(SleepDay, into=c("Date","SleepTime"), sep=" ",remove =TRUE )
sleep_log$Date <-  as.Date(sleep_log$Date,format='%m/%d/%Y')
weight_log <- weight_log %>% 
  separate(Date, into=c("Date","Time"), sep=" ",remove =TRUE )
weight_log$Date <-  as.Date(weight_log$Date,format='%m/%d/%Y') 
# Taking only Id,Date,WeightKg,BMI,IsManualReport  fields
weight_log <- weight_log %>% 
  select(Id,Date,WeightKg,BMI,IsManualReport)
# Summary of the dataset after formatting
skim_without_charts(daily_activity)
skim_without_charts(sleep_log)
skim_without_charts(weight_log)

```
### Clean and Manipulate
* Find and remove duplicated records
* Rename ActivityDate column to **Date**
* Create a new column with **Weekdays**

```{r}
#Find duplicates

sum(duplicated(daily_activity))
sum(duplicated(sleep_log))
sum(duplicated(weight_log))

#remove duplicates
sleep_log<-unique(sleep_log)

#Rename ActivityDate column to Date

colnames(daily_activity)[colnames(daily_activity) == "ActivityDate"] <- "Date"

#Add new column with weekdays

daily_activity$Weekdays<- wday(daily_activity$Date, label = TRUE, abbr = FALSE)

#Verify changes made

glimpse(daily_activity)

#Add new column with weekdays

sleep_log$Weekdays<- wday(sleep_log$Date, label = TRUE, abbr = FALSE)

#Verify Sleep Day in date format

glimpse(sleep_log)

#Add new column with weekdays

weight_log$Weekdays<- wday(weight_log$Date, label = TRUE, abbr = FALSE)

#Verify changes made

glimpse(weight_log)
```

### Check for any outlier
```{r}
number_of_logs <- daily_activity %>% 
  count(Id) %>% 
  arrange(n)


ggplot(number_of_logs, aes(x=Id, y=n)) + 
  geom_point()+
  geom_label( 
    data=number_of_logs %>% filter(n<21), # To label the outlier
    aes(label=Id)
  )+
  ggtitle("Number of Daily Entries by User Id")+
  labs(x="Unique ID", y="Number of daily entries)")+
  geom_hline(yintercept = 21, linetype="longdash", color="red")+
  theme(plot.title = element_text(size=12), text = element_text(size=10),axis.text.x = element_text(angle = 60, hjust = 1))
```

### Remove Outliers
```{r}
#Remove outliers from daily_activity
daily_activity <- daily_activity[!daily_activity$Id %in% c("2347167796","3372868164","4057192912","8253242879"),]

#Remove outliers from sleep_log
sleep_log <- sleep_log[!sleep_log$Id %in% c("2347167796","3372868164","4057192912","8253242879"),]

#Remove outliers from weight_log
weight_log <- weight_log[!weight_log$Id %in% c("2347167796","3372868164","4057192912","8253242879"),]
```
## Detailed summary of cleaned Dataset
```{r echo=FALSE, warning=FALSE,message=TRUE}
skim_without_charts(daily_activity)
skim_without_charts(sleep_log)
skim_without_charts(weight_log)

```

# Analysis phase :Analyze Data to Answer Questions

We will analyze trends of the users of FitBit and determine if that can help us on BellaBeat's marketing strategy. 

## Type of users per activity level 

since we don't have any demographic variables from our sample we want to determine the type of users with the data we have. We can classify the users by activity considering the daily amount of steps. We can categorize users as follows:

* Sedentary - Less than 5000 steps a day.
* Low active - Between  5000 and 7499 steps a day. 
* fairly active - Between 7500 and 9999 steps a day.
* Highly Active - More than 10000 steps a day.
Classification has been made per the following article <https://pubmed.ncbi.nlm.nih.gov/14715035/>

```{r echo= FALSE, warning=FALSE,message=TRUE}
daily_activity <- daily_activity %>%
  mutate(Daily_Activity_type = case_when(
    TotalSteps < 5000 ~ "Sedentary",
    TotalSteps >= 5000 & TotalSteps < 7499 ~ "Low active", 
    TotalSteps >= 7500 & TotalSteps < 9999 ~ "fairly active", 
    TotalSteps >= 10000 ~ "Highly active"
  ))
Activity_type_df <- daily_activity %>% group_by(Daily_Activity_type) %>% summarise(total=n()) %>% 
  ungroup() %>% 
  mutate(perc = total / sum(total)) %>%
  arrange(perc) %>%
  mutate(perc = scales::percent(perc))
Activity_type_df$Daily_Activity_type <- factor(Activity_type_df$Daily_Activity_type , levels = c("Highly active", "fairly active", "Low active", "Sedentary"))
head(Activity_type_df)
```
# Share phase: Share Data Through the Art of Visualization
## Users daily Lifestyle
* Half of the User's Daily Activity record haven't reached 8000 steps per Day
* Only One-third of the Users Daily activity have reached 10000 steps and more
```{r fig.align= 'center',echo= FALSE, warning=FALSE,message=TRUE}
ggplot(Activity_type_df, aes(x = "", y = total, fill = Daily_Activity_type)) +
  geom_col() +
  geom_text(aes(label = perc),
            position = position_stack(vjust = 0.5)) +
  coord_polar(theta = "y") + theme_void() + 
  labs(title="Daily Lifestyle type distribution",
       caption = 'Data Source: FitBit Fitness Tracker Data')
```

## Daily Activity type distribution in minutes

* Majority Users are sitting all day.

We can see that a majority of the day (81%) users are **sedentary**. 
There are serious health effects of too much sitting as per the following article <https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3404815/>

```{r, fig.align = 'center',echo= FALSE, warning=FALSE,message=TRUE}
# Activity in minutes
daily_activity %>% 
  select(VeryActiveMinutes, 
         FairlyActiveMinutes, 
         LightlyActiveMinutes, 
         SedentaryMinutes) %>% 
  summarise(across(everything(), list(sum))) %>% 
  gather(active_level, minutes) %>% 
  mutate(active_level = factor(active_level, 
                          labels = c('Moderate Activity','Light Activity',
                                     'Sedentary','Heavy Activity'))) %>% 
  ggplot(aes(x=active_level, y=minutes)) +
         geom_bar(stat="identity")+
  labs(title="Daily Activity type distribution in minutes", x= "Activity type", y="Total time spend in minutes",
       caption = 'Data Source: FitBit Fitness Tracker Data')
```

### Users display long sedentary minutes throughout the day.

The average daily sedentary minutes for all participants is **988** minutes, or **16.47** hours.
```{r fig.align = 'center',echo= FALSE, warning=FALSE,message=TRUE}
avg_sedentaryminutes=mean(daily_activity$SedentaryMinutes,na.rm=TRUE)
ggplot(daily_activity, aes(x=SedentaryMinutes)) + 
  geom_histogram(aes(y=..density..), binwidth=100,alpha=0.2)+
  geom_density(alpha=0.2, fill="#2F4F4F") +
  geom_vline(aes(xintercept=avg_sedentaryminutes), color="red", linetype="longdash")+
  geom_text(mapping=aes(x=avg_sedentaryminutes, y=0, label=sprintf("Mean: %1.0f minutes", avg_sedentaryminutes)), size=4, angle=90, vjust=-0.4, hjust=0) +
  labs(title="Sedentary Minutes Distribution", x= "Sedentary Minutes", y="Density",
       caption = 'Data Source: FitBit Fitness Tracker Data')
```

## Users' activity by day
### Users are more motivated to work out at the beginning of the week.

Users start off the week active and slow down mid-week(Highest activity is seen on Tuesday). This could be due to busy work schedules. There tends to be a pick up by Saturday which could be due to the weekend users spending time outdoors. 

```{r fig.align = 'center',echo= FALSE, warning=FALSE,message=TRUE}
daily_activity %>% 
  select(Weekdays, TotalSteps) %>% 
  group_by(Weekdays) %>% 
  ggplot(aes(Weekdays, TotalSteps)) +
  geom_bar(stat= "identity") +
  theme(axis.text.x = element_text(angle = 45)) +
  labs(
    title = "Users' activity by day",
    x = "Day of the week",
    y = "Total Steps",
    caption = 'Data Source: FitBit Fitness Tracker Data'
  )
```

## Customers use Bellabeat smart gadgets to record the daily activity the most
* **Daily Activity**
  + 29 Users
  + 879 records
  
  
* **Daily Sleep** 
  + 23 Users
  + 395 records

It is most common for the Users to use fitness trackers to record daily activity. However, users do not always record their daily sleep and weight.

This could be due to lack of comfort to sleep with their fitness trackers at night and therefore taking them off before getting in bed. Consider reviewing the design of fitness tracker to make it more comfortable.

```{r fig.align = 'center',echo= FALSE, warning=FALSE,message=TRUE}
recored_type <- c("Daily activity records","Sleep log records","Weight log records")
record_number <-c(n_distinct(daily_activity$Id),n_distinct(sleep_log$Id), n_distinct(weight_log$Id))
record_count <- data.frame(recored_type,record_number)

ggplot(record_count, aes(recored_type,record_number)) +
  geom_bar(stat= "identity")+ 
  geom_text(aes(label=record_number), vjust=4, color="white")+
  labs(title="Total Records by Types",  x= "Record Types", y="Number of Records",
       caption = 'Data Source: FitBit Fitness Tracker Data')
```

* **Daily Weight** 
  + 8 Users
  + 67 records
  
* Only 28% of the users recorded their weight 
Only **8** out of **29** users recorded their weight. Due to the small sample set, I would not be able to gather significant statistical analysis from the data. 

However, it would be worthwhile to explore why users are not logging their weight as much as daily activity and sleep.

* Nearly double the amount of entries were manually reported

```{r fig.align = 'center',echo= FALSE, warning=FALSE,message=TRUE}
report_method_name <- c("Manual Report","Auto Report")

report_method_T_F <- c(length(which(weight_log$IsManualReport =="True")),length(which(weight_log$IsManualReport =="False")))

data.frame(report_method_name,report_method_T_F) %>% 
ggplot(aes(report_method_name,report_method_T_F)) +
  geom_bar(stat= "identity")+ 
  geom_text(aes(label=report_method_T_F), vjust=3, color="white", size=5)+
  labs(title="Weight Log Records by Types",  x= "Weight Log Records", y="Number of Records",caption = 'Data Source: FitBit Fitness Tracker Data')

```


## Users have adequate sleep
```{r fig.align = 'center',echo= FALSE, warning=FALSE,message=TRUE}
ggplot(sleep_log, aes(x=TotalMinutesAsleep)) + 
  geom_histogram(aes(y=..density..), binwidth=30,alpha=0.2)+
  geom_density(alpha=0.2, fill="#2F4F4F") +
  geom_vline(aes(xintercept=mean(TotalMinutesAsleep, na.rm=TRUE)), color="red", linetype="dashed")+
  geom_text(mapping=aes(x=mean(TotalMinutesAsleep, na.rm=TRUE), y=0, label=sprintf("Mean: %1.0f minutes", mean(TotalMinutesAsleep, na.rm=TRUE))), size=4, angle=90, vjust=-0.4, hjust=0) +
  labs(title="Total minutes Asleep plot", x= "Total minutes Asleep", y="Density",
       caption = 'Data Source: FitBit Fitness Tracker Data')
```
The data shows that the sleep time is normally distributed among all users. The average sleep time is 418 minutes(~7 hrs Sleep), which means on average, participants have adequate sleep.

## Calories burned by steps
```{r fig.align = 'center',echo= FALSE, warning=FALSE,message=FALSE}
# Calories vs Total Steps
daily_activity %>% 
  group_by(TotalSteps, Calories) %>% 
  ggplot(aes(x = TotalSteps, y = Calories)) +
  geom_point() +
  geom_smooth() +
  labs(title = 'Calories burned by total steps taken',
       y = 'Calories',
       x = 'Total Steps',
       caption = 'Data Source: FitBit Fitness Tracker Data')
```
There is a clear positive correlation between these two variables: the more steps taken in a day, the more calories burned.
To make sure of this assumption, we can check the correlation between these two variable using the *Pearson Correlation Coefficient*.

Simply put, the Pearson Correlation Coefficient is a measure of linear correlation between 2 variables. For more information, click [here](https://en.wikipedia.org/wiki/Pearson_correlation_coefficient)
```{r echo=FALSE, warning=FALSE,message=FALSE}
cor.test(daily_activity$TotalSteps, daily_activity$Calories, method = 'pearson', conf.level = 0.95)
```
With a confidence level of 95%, the correlation between the variables is almost 0.6. This means that there is a strong relationship between the variables.


# Act Phase(Conclusion): Time to act on your data

## Daily notification on the total steps
We have seen a correlation between steps and calories So Calories are burnt by the steps taken daily. Based on users' objectives, Bellabeat could recommend a minimum number of 8,000 to 10,000 steps is a decent goal for daily walking.
sending them alarms if they haven't reached the steps and also creating posts on our app explaining the health benefits of reaching that goal.

## Alert notification for too much sitting
From the Users Daily Activity, We have seen that around 81% of the time spend is Sedentary.As recent study shows sitting all day causes serious Health effects, Bellabeat could send alert notification when user is showing Sedentary behaviour for a given amount of time and also receives a task to do like take a walk or any exercise customized by the User with a side note Bellabeat should remind the User the reasons why sitting too much is bad for health

## Keeping track on the Users Daily Sleeping hours
We have seen that there is a very few records of Uses Daily sleep Log. It signifies User removes the gadget before sleep.Keeping track of their daily sleeping hours and issue an alert next day if the User didnt have sufficient sleep.Also offer helpfull resources to help customers sleep - ex. breathing advises, podcasts with relaxing music, sleep techniques.
Based on Users profile, recommend the best sleeping hours range for health growth and well being
Users could set up a desired time to go to sleep and receive a notification minutes before prepare to sleep. 

## Reward system 
* We are aware that some people don't get motivated by notifications so we can classify them into different levels/categories and will lose/gain points based on their daily activity and all these points will be accumulated by Week/Year which would inturn reflect the Level they are.
* The more points they receive the more they can avail the discounted prices of any Bellabeat products.
* Also the merits accumulated is to be used before the end of the Year after that it will be reset to zero.
This will encourage Users to wear Bellabeat gadgets more frequently which would help the Bellabeat app to gain more valuable insights from their daily activities and also improve Bellabeat advertising. Two birds with one stone